import{g as b,c as h,d as f,q as k,w as q}from"./firebase-27c2c523.js";import{b as E}from"./verifySession-343b1a89.js";import{y as D}from"./side-effects-16dd37a6.js";import{r as c,a$ as I,o as n,c as s,a as o,P as i,R as u,bd as g,t as d}from"./index-e9195293.js";const V={key:0,class:"container-fluid m-0 p-0"},$={ref:"video",autoplay:"",class:"w-100 mb-0 pb-0"},B={key:1,class:"container-fluid mt-3"},F={class:"row"},M={class:"col-12 p-4"},N={class:"row"},R={class:"col-12 bg-black rounded-top text-center p-0 m-0"},O=["src"],j={class:"col-12 bg-gray pb-3 mb-2"},z={class:"pt-3 h2 mb-0 pb-0"},L=o("hr",null,null,-1),Q=o("hr",null,null,-1),U=o("hr",null,null,-1),A=o("hr",null,null,-1),G={key:0,class:"text-center"},H=o("p",{class:"alert alert-danger"},"El codigo de barra ya esta registrado",-1),Y={__name:"BarcodeScanner",emits:["data"],setup(J,{emit:w}){const _=c([]),v=c(!1),l=c(!0),p=c([]),y=c([]);c();const m=c(!1),x=()=>{window.location.reload()};I(async()=>{E();const r=document.querySelector("video"),a={video:{facingMode:"environment"}};(await b(h(f,"proveedores"))).forEach(e=>{p.value.push({...e.data(),id:e.id}),y.value.push({...e.data(),id:e.id})}),navigator.mediaDevices.getUserMedia(a).then(e=>{r.srcObject=e,r.play(),C()}).catch(e=>{console.error("Error accessing camera:",e)})});async function C(){const r=document.querySelector("video"),a=new D({formats:["qr_code","ean_13","code_128","aztec","code_39","code_93","codabar","databar","databar_expanded","data_matrix","dx_film_edge","ean_8","itf","maxi_code","micro_qr_code","pdf417","rm_qr_code","upc_a","upc_e","linear_codes","matrix_codes"]}),t=setInterval(async()=>{const e=await a.detect(r);if(e.length>0){clearInterval(t);const S=await b(k(h(f,"inventario"),q("barcode","==",e[0].rawValue)));l.value=!1,v.value=!0,S.empty?w("data",e[0].rawValue):(l.value=!0,m.value=!0)}},1e3)}const P=()=>{_.value.forEach(r=>{localStorage.setItem("idProduct",r.id);const a=window.location.href,e=a.slice(0,a.lastIndexOf("/"))+"addorupdate";window.location.replace(e)})};return(r,a)=>(n(),s(u,null,[l.value?(n(),s("div",V,[o("video",$,null,512)])):i("",!0),v.value?(n(),s("div",B,[o("div",F,[o("div",M,[(n(!0),s(u,null,g(_.value,t=>(n(),s("div",N,[o("div",R,[o("img",{src:t.image,alt:"",class:"w-100 p-0 m-0 rounded-top"},null,8,O)]),o("div",j,[o("p",z,d(t.name),1),L,o("p",null,"Precio Costo: "+d(t.price)+"$",1),Q,o("p",null,"Precio Venta: "+d(t.priceSale)+"$",1),U,(n(!0),s(u,null,g(p.value,e=>(n(),s("p",null,"Proveedor: "+d(e.name),1))),256)),A,o("p",null,"Cantidad Disponible: "+d(t.count),1)]),o("button",{class:"btn btn-primary mb-2",onClick:a[0]||(a[0]=e=>P())},"Editar Producto")]))),256)),m.value?(n(),s("div",G,[H,o("button",{class:"btn btn-success mb-2",onClick:a[1]||(a[1]=t=>x())},"Reiniciar Scanner")])):i("",!0)])])])):i("",!0)],64))}};export{Y as _};
