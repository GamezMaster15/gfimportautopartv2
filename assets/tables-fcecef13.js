import{b as R,c as N,a as O,e as $}from"./firebase-da6e628f.js";import{_ as U}from"./CardSolid-07b1e509.js";import{_ as j}from"./DemoSimpleTableBasics-401d635f.js";import{C as z,a as w,b as G}from"./CardBasic-f04f2f72.js";import{V as q}from"./VAlert-8122022d.js";import{V as m}from"./VCol-be91beef.js";import{V as S}from"./VRow-bf744c0d.js";import{a as E,c as H,V as g,e as J}from"./VCard-f2d7cbd6.js";import{a as K}from"./VTextField-3660a98e.js";import{r,w as Q,o as n,c as B,i as e,f as a,R as P,bd as F,e as b,j as W,p as d,t as V,P as I,bS as D,a$ as X,V as Y,a as v}from"./index-ba7efa84.js";import{V as Z}from"./VDialog-09695396.js";import"./VAvatar-f72d3f84.js";import"./VImg-86c86b93.js";import"./VTable-bcc207ed.js";import"./DemoFormLayoutMultipleColumn-2ce41123.js";import"./VSelect-ead6db5f.js";import"./forwardRefs-9d31fcaa.js";import"./VMenu-1b77b7ed.js";import"./index-beb39f3d.js";import"./VDivider-f5c08ea2.js";import"./VOverlay-31578629.js";import"./dialog-transition-4730997b.js";import"./VCheckboxBtn-13042f47.js";import"./VChip-1538c857.js";import"./_plugin-vue_export-helper-c27b6911.js";const ee={__name:"CardsOrder",props:{search:{type:null,required:!0}},emits:["items"],setup(y,{emit:k}){const s=y,i=r(0),c=r(!1),h=[u=>!!u||"La cantidad es requerida",u=>u&&u<=parseInt(o.value.count)||"La cantidad no puede exceder de "+parseInt(o.value.count)],o=r(),x=r(),p=r(!1),f=r(!1);Q(()=>s.search,()=>{w.value=G.value.filter(u=>u.name.toLowerCase().includes(s.search.toLowerCase())),w.value.length===0?f.value=!0:f.value=!1});const A=u=>{p.value=!0,o.value=u.data,x.value=u.index},L=()=>{w.value[parseInt(x.value)].count=w.value[parseInt(x.value)].count-parseInt(i.value),p.value=!1,o.value.countVendidos=i.value,k("items",o.value),o.value={},i.value=0},T=()=>{parseInt(o.value.count)<parseInt(i.value)?c.value=!0:c.value=!1};return(u,l)=>(n(),B("div",null,[e(S,null,{default:a(()=>[(n(!0),B(P,null,F(W(w),(t,_)=>(n(),b(z,{card:{name:t.name,description:t.description,count:t.count,price:t.price,codepart:t.codepart,priceSale:t.priceSale,img:t.image,buttonSale:!1,id:t.id,order:!0,i:_,data:t},onAddProductOrder:A},null,8,["card"]))),256)),f.value?(n(),b(m,{key:0,cols:"6",class:"mx-auto"},{default:a(()=>[e(q,{color:"danger"},{default:a(()=>[d(" El producto: "+V(y.search)+" no fue encontrado :/ ",1)]),_:1})]),_:1})):I("",!0)]),_:1}),e(Z,{modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=t=>p.value=t),"max-width":"600px"},{default:a(()=>[e(E,null,{default:a(()=>[e(H,{class:"headline text-center mt-3 mb-0 pb-0"},{default:a(()=>[d("Cantidad a llevar")]),_:1}),e(g,null,{default:a(()=>[e(K,{type:"number",label:"Ingrese la cantidad de items",modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=t=>i.value=t),onInput:T,rules:h},null,8,["modelValue"]),e(q,{class:"mt-3"},{default:a(()=>[d("La cantidad debe ser mayor a 0 y menor a "+V(o.value.count),1)]),_:1})]),_:1}),e(J,null,{default:a(()=>[e(D,{onClick:L,class:"mx-auto",color:"primary",disabled:c.value},{default:a(()=>[d("Aceptar")]),_:1},8,["disabled"]),e(D,{onClick:l[1]||(l[1]=()=>{p.value=!1,o.value.value=null}),class:"mx-auto",color:"danger"},{default:a(()=>[d("Cerrar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ae={class:"mb-0"},te=v("b",null,"Cliente:",-1),le={class:"mb-0"},oe=v("b",null,"ID:",-1),re={class:"mb-0"},ue=v("b",null,"Ubicacion:",-1),ne={class:"mb-0"},se=v("b",null,"NÂ° de orden:",-1),ce=!0,Ee={__name:"tables",props:{search:{type:null,required:!0}},setup(y){const k=r({}),s=r({}),i=r([]),c=r(null),h=r(!1),o=r([]),x=r(0),p=r(!1),f=r(!1),C=r("bx-arrow-to-right");X(async()=>{await R(N(O,"order")).then(l=>{if(l.empty)s.value={ordenNumber:1};else{let t=1;l.forEach(_=>{t++,s.value={ordenNumber:t}})}}),await R(N(O,"clientes")).then(l=>{l.forEach(t=>{i.value.push({...t.data(),id:t.id})})})});const A=l=>{c.value=l,h.value=!0},L=l=>{p.value=!0,console.log(o.value.lenght);const t=o.value.findIndex(_=>_.id===l.id);t!==-1?o.value[t].countVendidos=parseInt(o.value[t].countVendidos)+parseInt(l.countVendidos):(o.value.push({...l}),x.value=o.value.length)},T=()=>{C.value==="bx-arrow-to-right"?(C.value="bx-arrow-to-left",h.value=!1,f.value=!0):(C.value="bx-arrow-to-right",h.value=!0,f.value=!1)},u=async()=>{s.value={...s.value,id_user:c.value.id,status:100},await $(N(O,"order"),s.value),await Promise.all(o.value.map(async l=>{k.value={idOrder:s.value.ordenNumber,id_product:l.id,count:l.countVendidos,description:l.description,price:l.priceSale},await $(N(O,"productOrder"),k.value)})).then(l=>{const t=window.location.href,M=t.slice(0,t.lastIndexOf("/"))+"/order";window.location.replace(M)})};return(l,t)=>(n(),B(P,null,[c.value===null?(n(),b(S,{key:0},{default:a(()=>[e(m,{cols:"12"},{default:a(()=>[e(E,{title:"Seleccion el cliente"})]),_:1}),(n(!0),B(P,null,F(i.value,_=>(n(),b(U,{data:_,onDataS:A},null,8,["data"]))),256))]),_:1})):I("",!0),h.value?(n(),b(ee,{key:1,onItems:L,search:y.search},null,8,["search"])):I("",!0),p.value?(n(),b(D,{key:2,icon:"bx-arrow-to-right",style:{position:"fixed",bottom:"4em",right:"2em"},onClick:T},{default:a(()=>[e(Y,{icon:C.value},null,8,["icon"])]),_:1})):I("",!0),f.value?(n(),b(S,{key:3},{default:a(()=>[e(m,null,{default:a(()=>[e(E,{class:"p-3",flat:""},{default:a(()=>[e(S,null,{default:a(()=>[e(m,{cols:"auto"},{default:a(()=>[e(g,null,{default:a(()=>[v("p",ae,[te,d(" "+V(c.value.name),1)])]),_:1})]),_:1}),e(m,{cols:"auto"},{default:a(()=>[e(g,null,{default:a(()=>[v("p",le,[oe,d(" "+V(c.value.document),1)])]),_:1})]),_:1}),e(m,{cols:"auto"},{default:a(()=>[e(g,null,{default:a(()=>[v("p",re,[ue,d(" "+V(c.value.direction),1)])]),_:1})]),_:1}),e(m,{cols:"auto"},{default:a(()=>[e(g,null,{default:a(()=>[v("p",ne,[se,d(" 000"+V(s.value.ordenNumber),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(j,{product:o.value,preOrder:ce},null,8,["product"])]),_:1}),e(m,null,{default:a(()=>[e(D,{onClick:u},{default:a(()=>[d(" Completar Orden ")]),_:1})]),_:1})]),_:1})):I("",!0)],64))}};export{Ee as default};
