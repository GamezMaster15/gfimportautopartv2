import{b as C}from"./verifySession-85950a7e.js";import{C as S}from"./CardBasic-742a5b37.js";import{y as k}from"./side-effects-16dd37a6.js";import{g as h,c as y,q as B,w as D,d as g}from"./firebase-27c2c523.js";import{r as a,a$ as E,o as t,c as n,a as i,P as l,R as w,bd as I,e as M}from"./index-a3a041e5.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./VCard-d5960204.js";import"./VAvatar-8b72b2c7.js";import"./VImg-b9f8bb6a.js";import"./VDivider-a82506d3.js";import"./VCol-ad427ed1.js";const N={key:0,class:"container-fluid m-0 p-0"},P={ref:"video",autoplay:"",class:"w-100 mb-0 pb-0"},R={key:1,class:"container-fluid mt-3"},V={class:"row"},F={class:"col-12 p-4"},$={key:0,class:"text-center"},j=i("p",{class:"alert alert-danger"},"Codigo de barra no registrado",-1),X={__name:"scanner",props:{search:{type:null,required:!0}},setup(z){const u=a([]),p=a(!1),d=a(!0),v=a([]),m=a([]),_=a(),f=a(!1),q=()=>{window.location.reload()};E(async()=>{C();const c=document.querySelector("video"),r={video:{facingMode:"environment"}};(await h(y(g,"proveedores"))).forEach(e=>{v.value.push({...e.data(),id:e.id}),m.value.push({...e.data(),id:e.id})}),navigator.mediaDevices.getUserMedia(r).then(e=>{c.srcObject=e,c.play(),x()}).catch(e=>{console.error("Error accessing camera:",e)})});async function x(){const c=document.querySelector("video"),r=new k({formats:["qr_code","ean_13","code_128","aztec","code_39","code_93","codabar","databar","databar_expanded","data_matrix","dx_film_edge","ean_8","itf","maxi_code","micro_qr_code","pdf417","rm_qr_code","upc_a","upc_e","linear_codes","matrix_codes"]}),o=setInterval(async()=>{const e=await r.detect(c);if(e.length>0){clearInterval(o);const b=await h(B(y(g,"inventario"),D("barcode","==",e[0].rawValue)));d.value=!1,p.value=!0,b.empty?(d.value=!0,f.value=!0):(b.forEach(async s=>{u.value.push({...s.data(),id:s.id}),_.value=s.data().proveedor}),v.value=m.value.filter(s=>s.id.includes(_.value)))}},1e3)}return(c,r)=>(t(),n(w,null,[d.value?(t(),n("div",N,[i("video",P,null,512)])):l("",!0),p.value?(t(),n("div",R,[i("div",V,[(t(!0),n(w,null,I(u.value,o=>(t(),M(S,{card:{name:o.name,description:o.description,count:o.count,price:o.price,priceSale:o.priceSale,img:o.image,buttonSale:!1,priceCosto:!0}},null,8,["card"]))),256)),i("div",F,[f.value?(t(),n("div",$,[j,i("button",{class:"btn btn-success mb-2",onClick:r[0]||(r[0]=o=>q())},"Reiniciar Scanner")])):l("",!0)])])])):l("",!0)],64))}};export{X as default};
